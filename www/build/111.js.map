{"version":3,"sources":["../../src/pages/order-pay/order-pay.module.ts","../../src/providers/WechatPlugin.ts","../../src/pages/order-pay/order-pay.ts"],"names":[],"mappings":"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","file":"111.js?v=107","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { OrderPayPage } from './order-pay';\n\n@NgModule({\n  declarations: [\n    OrderPayPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(OrderPayPage),\n  ],\n})\nexport class OrderPayPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/order-pay/order-pay.module.ts","declare var Wechat: any;\r\n\r\nexport interface WechatPayParam {\r\n    appid: string;\r\n    partnerid: string;\r\n    prepayid: string;\r\n    package: string;\r\n    noncestr: string;\r\n    timestamp: string;\r\n    sign: string;\r\n}\r\n\r\nexport class WXScene {\r\n    public static WXSceneSession = \"WXSceneSession\";\r\n    public static WXSceneTimeline = \"WXSceneTimeline\";\r\n    public static WXSceneFavorite = \"WXSceneFavorite\";\r\n}\r\n\r\nexport class WechatPlugin {\r\n\r\n    public static isInstalled() {\r\n        return new Promise((resolve, reject) => {\r\n            Wechat.isInstalled(result => {\r\n                resolve(result);\r\n            }, error => {\r\n                reject(error);\r\n            });\r\n        });\r\n    }\r\n\r\n    public static sendPaymentRequest(params: WechatPayParam) {\r\n        return new Promise((resolve, reject) => {\r\n            Wechat.sendPaymentRequest(params, result => {\r\n                resolve(result);\r\n            }, error => {\r\n                reject(error);\r\n            });\r\n        });\r\n    }\r\n\r\n    public static ShareText(text: string) {\r\n        return new Promise((resolve, reject) => {\r\n            Wechat.share({\r\n                text: '逛贝微信分享测试',\r\n                scene: WXScene.WXSceneSession\r\n            }, result => {\r\n                alert(\"分享成功\");\r\n            }, error => {\r\n                alert(\"分享失败\");\r\n            });\r\n        })\r\n    }\r\n} \n\n\n// WEBPACK FOOTER //\n// ./src/providers/WechatPlugin.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams,App } from 'ionic-angular';\nimport { HttpService } from './../../providers/HttpService';\nimport { NativeService } from './../../providers/NativeService';\nimport { Parameter } from './../../model/Model';\nimport { WechatPlugin } from './../../providers/WechatPlugin';\ndeclare var wx: any;\ndeclare var AliPay: any;\n@IonicPage()\n@Component({\n  selector: 'page-order-pay',\n  templateUrl: 'order-pay.html',\n})\nexport class OrderPayPage {\n  datalist: any;\n  orderId: any;\n  img2 = \"assets/imgs/eixin.png\";\n  img3 = \"assets/imgs/chone.png\";\n  img4 = \"assets/imgs/unchone.png\";\n  img5 = \"assets/imgs/zhifun.png\";\n  fanhui = \"assets/imgs/fanhui2.png\";\n  sousuo = \"assets/imgs/shousuo.png\";\n  gouwu = \"assets/imgs/gouwuche.png\";\n  complte = \"assets/imgs/complte.png\";\n  paysuccess=false;\n  paytype = 2;\n  isweb = false;\n  OrderList:any;\n  constructor(public navCtrl: NavController,\n    public navParams: NavParams,\n    private httpService: HttpService,\n    private app: App,\n    private nativeService: NativeService,\n    /* private storage: Storage */) {\n    this.OrderList = this.navParams.get(\"item\");\n    this.orderId = this.navParams.get(\"orderId\");\n    this.login();\n    this.isweb = !this.nativeService.isMobile();\n  }\n  ionViewDidLoad() {\n  }\n  login() {\n    var userInfo = {\n      OrderID: this.orderId,\n    };\n    //console.info(userInfo)\n    var parameter = new Parameter();\n    parameter.jyh = \"1057\";\n    parameter.parm = JSON.stringify(userInfo);\n    this.nativeService.showLoading(\"获取中\");\n    this.httpService.post(\"/MobService/Index\", parameter).map(res => res.json()).subscribe(res => {\n      this.nativeService.hideLoading();\n      var result = JSON.parse(res.result);\n      //console.info(result)\n      if (result.Code == 1) {\n        this.datalist = result.Data;\n      } else {\n      }\n\n    })\n  }\n  pay2(){\n    var that=this;\n    wx.chooseWXPay({\n      timestamp: that.datalist.timestamp, // 支付签名时间戳，注意微信jssdk中的所有使用timestamp字段均为小写。但最新版的支付后台生成签名使用的timeStamp字段名需大写其中的S字符\n      nonceStr: that.datalist.noncestr, // 支付签名随机串，不长于 32 位\n      package: that.datalist.package, // 统一支付接口返回的prepay_id参数值，提交格式如：prepay_id=\\*\\*\\*）\n      signType: that.datalist.signType, // 签名方式，默认为'SHA1'，使用新版支付需传入'MD5'\n      paySign: that.datalist.sign, // 支付签名\n      success: function (res) {\n        that.paysuccess=true;\n        // if (res.chooseWXPay == \"ok\") {\n        //   that.navCtrl.setRoot(\"PaySuccessPage\", {\n        //     Info: that.datalist.OrderOrlTotal\n        //   });\n        // }\n        // 支付成功后的回调函数\n      }\n    });\n  }\n  pay() {\n    var userInfo = {\n      OrderID: this.orderId,\n      PayType: this.paytype,\n      isweb: this.isweb ? 1 : 0\n    };\n    var that = this;\n    ////console.info(userInfo)\n    var parameter = new Parameter();\n    parameter.jyh = \"1058\";\n    parameter.parm = JSON.stringify(userInfo);\n    this.nativeService.showLoading(\"获取中\");\n    this.httpService.post(\"/MobService/Index\", parameter).map(res => res.json()).subscribe(res => {\n\n      var result = JSON.parse(res.result);\n      //console.info(result);\n      if (result.Code == 1) {\n        if (this.paytype == 1) {\n          /**处理支付宝逻辑 */\n          this.nativeService.hideLoading();\n          AliPay.pay(result.Msg, success => {\n            var msg = JSON.parse(success.result);\n            if (msg.alipay_trade_app_pay_response.msg == \"Success\") {\n              this.nativeService.showToast(\"支付订单成功\");\n              this.navCtrl.setRoot(\"PaySuccessPage\", {\n                Info: that.datalist.OrderOrlTotal\n              });\n            }\n          }, error => {\n\n          });\n        } else {\n          /*处理微信逻辑 */\n          var data = result.Data;\n          //console.info(\"微信支付\")\n          if (this.isweb) {\n            this.nativeService.hideLoading();\n            /**微信内部 */\n            wx.chooseWXPay({\n              timestamp: data.timestamp, // 支付签名时间戳，注意微信jssdk中的所有使用timestamp字段均为小写。但最新版的支付后台生成签名使用的timeStamp字段名需大写其中的S字符\n              nonceStr: data.noncestr, // 支付签名随机串，不长于 32 位\n              package: data.package, // 统一支付接口返回的prepay_id参数值，提交格式如：prepay_id=\\*\\*\\*）\n              signType: data.signType, // 签名方式，默认为'SHA1'，使用新版支付需传入'MD5'\n              paySign: data.sign, // 支付签名\n              success: function (res) {\n                that.paysuccess=true;\n                if (res.chooseWXPay == \"ok\") {\n                  // that.navCtrl.setRoot(\"PaySuccessPage\", {\n                  //   Info: that.datalist.OrderOrlTotal\n                  // });\n                \n                }\n                // 支付成功后的回调函数\n              }\n            });\n          } else {\n            this.nativeService.hideLoading();\n            WechatPlugin.sendPaymentRequest(data).then((result) => {\n              this.navCtrl.setRoot(\"PaySuccessPage\", {\n                Info: that.datalist.OrderOrlTotal\n              });\n            }, error => {\n              this.nativeService.showToast(error);\n            });\n          }\n        }\n      } else if (result.Code == 2) {\n        this.nativeService.hideLoading();\n        this.navCtrl.setRoot(\"PaySuccessPage\", {\n          Info: that.datalist.OrderOrlTotal\n        });\n      } else {\n        this.nativeService.hideLoading();\n        this.nativeService.showToast(result.Msg);\n      }\n    });\n  }\n   //回到首页\n   gotohome() {\n    this.app.getRootNav().setRoot('TabsPage');\n  }\n  //查看订单\n  gotoOrderList() {\n    this.navCtrl.push(\"OrderListPage\", {\n      type: 0,\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/order-pay/order-pay.ts"],"sourceRoot":""}